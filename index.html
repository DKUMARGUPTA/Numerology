<script>
 <script>
  // --- CONFIG ---
  let lang = 'en';
  let isDarkMode = false;
  const translations = {
    placeholder: { hi: 'рдЕрдкрдирд╛ рдкреВрд░рд╛ рдирд╛рдо рд▓рд┐рдЦреЗрдВ', en: 'Your Full Name' },
    alert: { hi: 'рдХреГрдкрдпрд╛ рдирд╛рдо рдФрд░ рдЬрдиреНрдо рддрд┐рдерд┐ рднрд░реЗрдВред', en: 'Please enter your name and date of birth.' },
    reportTitle: { hi: 'рдЖрдкрдХреА рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░рд┐рдкреЛрд░реНрдЯ', en: 'Your Personal Report' },
    name: { hi: 'рдирд╛рдо', en: 'Name' },
    dob: { hi: 'рдЬрдиреНрдо рддрд┐рдерд┐', en: 'Date of Birth' },
    lifePath: { hi: 'рд▓рд╛рдЗрдл рдкрд╛рде рдирдВрдмрд░', en: 'Life Path Number' },
    loShu: { hi: 'рд▓реЛ рд╢реБ рдЧреНрд░рд┐рдб рд╡рд┐рд╢реНрд▓реЗрд╖рдг', en: 'Lo Shu Grid Analysis' },
    present: { hi: 'рдЖрдкрдХреЗ рдЬрдиреНрдо рддрд┐рдерд┐ рдореЗрдВ рдореМрдЬреВрдж рдЕрдВрдХ:', en: 'Numbers present in your DOB:' },
    career: { hi: 'рдХрд░рд┐рдпрд░', en: 'Career' },
    money: { hi: 'рдзрди', en: 'Money' },
    relationships: { hi: 'рд╕рдВрдмрдВрдз', en: 'Relationships' },
    truth: { hi: 'рд╕рдмрд╕реЗ рдЬрд╝рд░реВрд░реА рд╕рдЪреНрдЪрд╛рдИ', en: 'Most Important Truth' }
  };

  // --- INIT ---
  document.addEventListener('DOMContentLoaded', () => {
    if (navigator.language.startsWith('hi')) lang = 'hi';
    updateUI();
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      toggleTheme();
    }
  });

  function toggleLanguage() {
    lang = lang === 'hi' ? 'en' : 'hi';
    updateUI();
    if (document.getElementById('report').style.display !== 'none') generateReport();
  }

  function toggleTheme() {
    isDarkMode = !isDarkMode;
    document.body.classList.toggle('dark-mode', isDarkMode);
    document.querySelector('.toggle-icon').textContent = isDarkMode ? 'тШАя╕П' : 'ЁЯМЩ';
  }

  function updateUI() {
    const langs = document.querySelectorAll('.lang');
    langs.forEach(el => {
      el.classList.toggle('active', el.dataset.lang === lang);
    });
    document.getElementById('name').placeholder = translations.placeholder[lang];
  }

  function reduceToSingle(numStr) {
    let sum = numStr.split('').reduce((a, b) => a + Number(b), 0);
    while (sum > 9 && ![11, 22, 33].includes(sum)) {
      sum = sum.toString().split('').reduce((a, b) => a + Number(b), 0);
    }
    return sum;
  }

  // --- STORE REPORT DATA GLOBALLY ---
  let reportData = null;

  function generateReport() {
    const name = document.getElementById('name').value.trim();
    const dobInput = document.getElementById('dob').value;
    if (!name || !dobInput) return alert(translations.alert[lang]);

    document.getElementById('loader').style.display = 'block';

    setTimeout(() => {
      const cleanDOB = dobInput.replace(/-/g, '');
      const sumAll = cleanDOB.split('').reduce((a, b) => a + Number(b), 0);
      const lifePath = reduceToSingle(sumAll.toString());

      const loShu = [4, 9, 2, 3, 5, 7, 8, 1, 6];
      const presentSet = new Set(cleanDOB.split('').map(Number));
      const missing = loShu.filter(n => !presentSet.has(n));

      const texts = {
        lifePath: {
          hi: "рдЖрдкрдХрд╛ Life Path Number 9 рд╣реИ тАФ рдЖрдк рдПрдХ рдЖрджрд░реНрд╢рд╡рд╛рджреА, рд╕рд╣рд╛рдпрдХ рдФрд░ рд╕рдорд╛рдЬ-рд╕реЗрд╡реА рд╣реИрдВред рдЖрдк рджреВрд╕рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдХрд░рдирд╛ рдкрд╕рдВрдж рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдкрдиреА рднрд╛рд╡рдирд╛рдУрдВ рдХреЛ рдЫреБрдкрд╛рддреЗ рд╣реИрдВред рдЖрдкрдХреА рддрд╛рдХрдд: рдиреЗрддреГрддреНрд╡, рд╕рдордЭрджрд╛рд░реА, рд╕реЗрд╡рд╛ред рдЪреБрдиреМрддреА: рдЕрддрд┐-рднрд╛рд╡реБрдХрддрд╛, рдЕрдкреЗрдХреНрд╖рд╛рдПрдБ, рдЖрддреНрдо-рддреНрдпрд╛рдЧред",
          en: "Your Life Path is 9 тАФ you are idealistic, helpful, and service-oriented. You prefer to do things for others but hide your own emotions. Your strengths: leadership, empathy, service. Challenges: over-emotional, expectations, self-sacrifice."
        },
        missing: {
          hi: `рдЖрдкрдХреЗ Lo Shu Grid рдореЗрдВ рдирд┐рдореНрди рдирдВрдмрд░ рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реИрдВ: ${missing.join(', ')}ред рдЗрд╕рдХрд╛ рдЕрд░реНрде: рдЖрдкрдХреЛ рдЗрди рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рдЕрднреНрдпрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ тАФ рдЬреИрд╕реЗ: рдЕрдиреБрд╢рд╛рд╕рди (4), рдирд┐рд░реНрдгрдп рд▓реЗрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ (5), рдкрд╛рд░рд┐рд╡рд╛рд░рд┐рдХ рдЬрд┐рдореНрдореЗрджрд╛рд░реА (6), рдзреИрд░реНрдп (7), рдзрди рдкреНрд░рдмрдВрдзрди (8)ред`,
          en: `Your Lo Shu Grid is missing these numbers: ${missing.join(', ')}. This means you need to practice in these areas тАФ like discipline (4), decision-making (5), family responsibility (6), patience (7), money management (8).`
        },
        career: {
          hi: "рдЖрдкрдХреЗ рд▓рд┐рдП Sales, Teaching, NGO, Management рдЬреИрд╕реЗ рдХреНрд╖реЗрддреНрд░ рдЙрдкрдпреБрдХреНрдд рд╣реИрдВред рдЖрдк рд▓реЛрдЧреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдкрд╕рдВрдж рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдиреЗрддреГрддреНрд╡ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред",
          en: "Sales, Teaching, NGO, Management are suitable for you. You enjoy working with people and can lead effectively."
        },
        money: {
          hi: "рдкреИрд╕рд╛ рдЖрдПрдЧрд╛, рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдмрдЪрдд рдФрд░ рд▓рдВрдмреЗ рд╕рдордп рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рднрд╛рд╡рдирд╛рддреНрдордХ рдирд┐рд░реНрдгрдп рд╕реЗ рдмрдЪреЗрдВред",
          en: "Money will come, but you need to save and plan long-term. Avoid emotional decisions."
        },
        relationships: {
          hi: "рдЖрдк рджрд┐рд▓ рд╕реЗ рджреЗрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЬрдм рдЖрдкрдХреЛ рд╕рдореНрдорд╛рди рдирд╣реАрдВ рдорд┐рд▓рддрд╛ рддреЛ рдЖрдк рдШрд╛рдпрд▓ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред рд╕реНрдкрд╖реНрдЯ рд╕рдВрдЪрд╛рд░ рд░рдЦреЗрдВред",
          en: "You give from the heart, but get hurt when not appreciated. Maintain clear communication."
        },
        truth: {
          hi: "рдпреЗ рднрд╡рд┐рд╖реНрдп рдХреА рдЧрд╛рд░рдВрдЯреА рдирд╣реАрдВ рд╣реИ тАФ рдпреЗ рдПрдХ рд╕реНрд╡-рд╕рдордЭ рдХрд╛ рдЙрдкрдХрд░рдг рд╣реИред рдЖрдкрдХреА рдореЗрд╣рдирдд, рдХреМрд╢рд▓ рдФрд░ рдХрд╛рд░реНрдп рд╣реА рдЖрдкрдХрд╛ рднрд╡рд┐рд╖реНрдп рдмрдирд╛рддреЗ рд╣реИрдВред",
          en: "This is not a guarantee of future тАФ itтАЩs a tool for self-understanding. Your effort, skill, and action shape your destiny."
        }
      };

      // --- SAVE DATA FOR PDF ---
      reportData = {
        name,
        dob: dobInput,
        lifePath,
        insight: texts.lifePath[lang]
      };

      // --- BUILD REPORT HTML ---
      let gridHTML = '<div class="loshu-grid" style="background:white; border:1px solid #ddd;">';
      for (let num of loShu) {
        const cls = presentSet.has(num) ? 'present' : 'missing';
        gridHTML += `<div class="loshu-cell ${cls}" style="border:1px solid #ccc;">${num}</div>`;
      }
      gridHTML += '</div>';

      const reportHTML = `
        <div class="section-title">${translations.reportTitle[lang]}</div>
        <p><b>${translations.name[lang]}:</b> ${name}</p>
        <p><b>${translations.dob[lang]}:</b> ${dobInput}</p>
        <div class="section-title">${translations.lifePath[lang]}</div>
        <p><b>${sumAll} тЖТ ${lifePath}</b></p>
        <p>${texts.lifePath[lang]}</p>
        <div class="section-title">${translations.loShu[lang]}</div>
        <p>${translations.present[lang]} ${Array.from(presentSet).join(', ')}</p>
        <p>${texts.missing[lang]}</p>
        ${gridHTML}
        <div class="section-title">${translations.career[lang]}</div>
        <p>${texts.career[lang]}</p>
        <div class="section-title">${translations.money[lang]}</div>
        <p>${texts.money[lang]}</p>
        <div class="section-title">${translations.relationships[lang]}</div>
        <p>${texts.relationships[lang]}</p>
        <div class="section-title">${translations.truth[lang]}</div>
        <p><i>${texts.truth[lang]}</i></p>
      `;

      document.getElementById('report').innerHTML = reportHTML;
      document.getElementById('report').style.display = 'block';

      // Show certificate section
      document.getElementById('cname').innerText = name;
      document.getElementById('clife').innerText = lifePath;
      document.getElementById('ctext').innerText = texts.lifePath[lang];
      document.getElementById('certificate').style.display = 'block';

      document.getElementById('loader').style.display = 'none';
    }, 900);
  }

  // --- FIXED PDF FUNCTION ---
  function downloadPDF() {
    if (!reportData) {
      alert(lang === 'hi' ? 'рдкрд╣рд▓реЗ рд░рд┐рдкреЛрд░реНрдЯ рдЬрдирд░реЗрдЯ рдХрд░реЗрдВред' : 'Please generate report first.');
      return;
    }

    // Create a temporary printable element
    const printDiv = document.createElement('div');
    printDiv.style.padding = '30px';
    printDiv.style.fontFamily = 'Poppins, sans-serif';
    printDiv.style.background = 'white';
    printDiv.style.color = '#000';
    printDiv.style.maxWidth = '800px';
    printDiv.style.margin = '0 auto';
    printDiv.style.border = '2px dashed #6a5af9';
    printDiv.style.borderRadius = '20px';

    printDiv.innerHTML = `
      <div style="text-align:center; margin-bottom:20px;">
        <h2 style="color:#6a5af9; font-size:24px;">ЁЯУЬ Official Numerology Certificate</h2>
        <p><b>Name:</b> ${reportData.name}</p>
        <p><b>Life Path Number:</b> ${reportData.lifePath}</p>
        <p><b>Insight:</b> ${reportData.insight}</p>
        <p style="margin-top:30px; font-size:12px; color:#666;">
          Generated on ${new Date().toLocaleDateString()} | Cosmic Numerology
        </p>
      </div>
    `;

    document.body.appendChild(printDiv);

    const opt = {
      margin: 0.5,
      filename: 'Numerology-Certificate.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };

    // Generate PDF
    html2pdf().set(opt).from(printDiv).save().finally(() => {
      document.body.removeChild(printDiv);
    });
  }

  function shareWhatsApp() {
    if (!reportData) {
      alert(lang === 'hi' ? 'рдкрд╣рд▓реЗ рд░рд┐рдкреЛрд░реНрдЯ рдЬрдирд░реЗрдЯ рдХрд░реЗрдВред' : 'Please generate report first.');
      return;
    }
    const msg = lang === 'hi' 
      ? `рдореЗрд░рд╛ Life Path рдирдВрдмрд░ ${reportData.lifePath} рд╣реИ! рдЬрд╛рдирд┐рдП рдЖрдкрдХрд╛ рдХреНрдпрд╛ рд╣реИ? ЁЯСЙ ${window.location.href}`
      : `My Life Path is ${reportData.lifePath}! See yours? ЁЯСЙ ${window.location.href}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
  }
</script>
</script>
